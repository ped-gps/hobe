<div id="procedures">
    <header>
        <div class="title">
            <h1>Procedimentos</h1>
        </div>
    </header>

    <main>
        <div class="filters-actions">
            <div class="filters">
                <div class="filter">
                    <div class="input name">
                        <p-iconfield>
                            <input
                                pInputText
                                type="text"
                                placeholder="Pesquisar"
                                [(ngModel)]="textFilter"
                                (input)="onInputChange()"
                            />
                            <p-inputicon styleClass="pi pi-search" />
                        </p-iconfield>
                    </div>
                </div>

                <div class="filter">
                    <div class="input source">
                        <p-select
                            [options]="procedureSourceOptions"
                            placeholder="Selecione"
                            [(ngModel)]="selectedProcedureSource"
                            (onChange)="onSourceChange()"
                        />
                    </div>
                </div>
            </div>

            <div class="actions">
                <div class="action">
                    <p-button
                        label="Adicionar Procedimento"
                        class="button-blue-white button-icon-end"
                        [loading]="isSubmitting"
                        (onClick)="onAddProcedure()"
                    >
                        <span class="material-symbols-rounded">add</span>
                    </p-button>
                </div>
            </div>
        </div>

        <div class="table">
            <p-table
                [value]="procedures"
                [rows]="size"
                [totalRecords]="totalElements"
                [lazy]="true"
                [paginator]="true"
                [scrollable]="true"
                [loading]="isLoading"
                [first]="page * size"
                [sortField]="'name'"
                (onPage)="onPageChange($event)"
                (onSort)="onSortChange($event)"
            >
                <ng-template #header>
                    <tr>
                        <th
                            pSortableColumn="name"
                            style="width: 50%; text-align: center"
                        >
                            Nome <p-sortIcon field="name" />
                        </th>
                        <th
                            pSortableColumn="code"
                            style="width: 20%; text-align: center"
                        >
                            Código <p-sortIcon field="code" />
                        </th>

                        <th
                            pSortableColumn="value"
                            style="width: 20%; text-align: center"
                        >
                            Valor <p-sortIcon field="value" />
                        </th>
                        <th style="width: 10%; text-align: center">Ações</th>
                    </tr>
                </ng-template>
                <ng-template #body let-procedure>
                    <tr class="procedure">
                        <td style="text-align: left">
                            <span class="procedure-name">{{
                                procedure.name
                            }}</span>
                        </td>
                        <td style="text-align: center">
                            <span class="procedure-code">{{
                                procedure.code
                            }}</span>
                        </td>
                        <td style="text-align: center">
                            <span class="procedure-value">{{
                                procedure.value | currency
                            }}</span>
                        </td>
                        <td style="text-align: center">
                            <p-button
                                class="button-transparent-gray button-icon"
                                *ngIf="procedure.type === 'PROCEDURE'"
                                [rounded]="true"
                                [text]="true"
                                [loading]="isSubmitting"
                                (onClick)="
                                    selectedProcedure = procedure;
                                    procedureMenu.toggle($event)
                                "
                            >
                                <span class="material-symbols-rounded">
                                    more_vert
                                </span>
                            </p-button>
                        </td>
                    </tr>
                </ng-template>
                <ng-template #emptymessage>
                    <tr>
                        <td colspan="4" style="text-align: center">
                            Nenhum registro encontrado
                        </td>
                    </tr>
                </ng-template>
            </p-table>
        </div>
    </main>
</div>

<p-menu
    #procedureMenu
    appendTo="body"
    [popup]="true"
    [model]="procedureMenuOptions"
/>
